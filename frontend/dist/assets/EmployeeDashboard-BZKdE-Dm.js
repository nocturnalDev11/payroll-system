import{u as le,i as _,k as ie,q as ue,B as w,j as x,c as d,a as n,e as z,t as l,F as O,m as C,o as m,n as ce}from"./index-D08fRg5P.js";const de={class:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100"},me={class:"p-4"},ye={key:0,class:"mb-6 bg-white rounded-xl border-l-4 border-l-green-600 shadow-sm p-6"},pe={class:"flex items-center space-x-4"},he={class:"h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center"},ge={class:"text-blue-600 font-semibold text-lg"},fe={class:"text-xl font-bold text-gray-800"},ve={class:"text-sm text-gray-500"},xe={class:"grid grid-cols-1 lg:grid-cols-4 gap-6"},be={class:"lg:col-span-3 space-y-6"},_e={class:"bg-white rounded-xl shadow-sm p-6"},we={class:"flex justify-between items-center"},Se={class:"text-sm text-gray-500"},Te={class:"flex space-x-3"},Ee=["disabled"],Me=["disabled"],Pe={class:"bg-white rounded-xl shadow-sm overflow-hidden"},Ie={class:"overflow-x-auto"},De={class:"min-w-full divide-y divide-gray-200"},Ne={class:"bg-white divide-y divide-gray-200"},ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm"},Re={key:0},He={class:"lg:col-span-1"},$e={key:0,class:"bg-white rounded-xl shadow-sm p-6 border border-gray-200"},je={class:"text-center border-b-2 border-dashed border-gray-300 pb-4 mb-4"},Be={class:"text-sm text-gray-500"},Le={class:"text-sm text-gray-500"},We={class:"space-y-4"},ze={class:"text-gray-600"},Fe={class:"text-gray-800"},Ue={class:"border-t border-gray-200 pt-2 flex justify-between font-semibold text-sm"},Ge={class:"text-gray-600"},Je={class:"text-gray-800"},Ve={class:"border-t border-gray-200 pt-2 flex justify-between font-semibold text-sm"},Ye={class:"border-t-2 border-dashed border-gray-300 pt-4"},qe={class:"flex justify-between items-center"},Ke={class:"text-lg font-bold text-blue-600"},Qe={key:1,class:"bg-white rounded-xl shadow-sm p-6 text-center text-gray-500"},Xe="06:00:00",Ze="11:30:00",at={__name:"EmployeeDashboard",setup(et){const u=le(),F=ue(),g=localStorage.getItem("token"),s=_(null),p=_([]),b=_(!1),h=_(!1),A=_("Mar 16 - Mar 31, 2025"),S={minimumWage:610,deMinimisLimit:1e4,regularHolidays:["03/31/2025"],specialNonWorkingDays:[]};ie(async()=>{var t;if(!g||!u.isAuthenticated){F.push("/employee/login");return}await U(),(t=u.employee)!=null&&t._id&&await Promise.all([J(),E(),G()])});async function U(){var t;try{const e=await fetch(`${w}/api/employees/profile`,{headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json","user-role":u.userRole,"user-id":((t=u.employee)==null?void 0:t._id)||""}});if(!e.ok)throw new Error(await e.text());const a=await e.json();s.value=a,u.setEmployee(a)}catch(e){console.error("Error fetching profile:",e)}}async function G(){var t;try{const e=(t=u.employee)==null?void 0:t._id;if(!e)return;const a=await fetch(`${w}/api/employees/${e}/salary?month=2025-03`,{headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json","user-role":u.userRole,"user-id":e}});if(!a.ok)throw new Error(await a.text());const o=await a.json();s.value={...s.value,...o}}catch(e){console.error("Error fetching salary:",e)}}async function J(){var t;try{const e=(t=u.employee)==null?void 0:t._id;if(!e)return;const a=await fetch(`${w}/api/attendance/${e}`,{headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json","user-role":u.userRole,"user-id":e}});if(a.ok)p.value=await a.json();else if(a.status===404)p.value=[];else throw new Error(await a.text())}catch(e){console.error("Error fetching attendance:",e)}}async function E(){const t=new Date().toISOString().split("T")[0],e=p.value.filter(o=>new Date(o.date).toISOString().split("T")[0]===t),a=e[e.length-1];b.value=a&&a.timeIn&&!a.timeOut}async function V(){var t;if(!R()){alert("Time In is only allowed after 6:00 AM.");return}h.value=!0;try{const e=(t=u.employee)==null?void 0:t._id;if(!e)throw new Error("No employee ID");const a=await fetch(`${w}/api/attendance/time-in`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json","user-role":u.userRole,"user-id":e},body:JSON.stringify({employeeId:e})}),o=await a.json();if(!a.ok)throw new Error(o.message);p.value.push(o),await E()}catch(e){alert(e.message||"Failed to time in")}finally{h.value=!1}}async function Y(){var t;if(!H()){alert("Time Out is only allowed after 11:30 AM.");return}h.value=!0;try{const e=(t=u.employee)==null?void 0:t._id;if(!e)throw new Error("No employee ID");const a=await fetch(`${w}/api/attendance/time-out`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json","user-role":u.userRole,"user-id":e},body:JSON.stringify({employeeId:e})}),o=await a.json();if(!a.ok)throw new Error(o.message);const r=p.value.findIndex(c=>c._id===o._id);r!==-1&&(p.value[r]=o),await E()}catch(e){alert(e.message||"Failed to time out")}finally{h.value=!1}}function R(){return new Date().toLocaleTimeString("en-US",{hour12:!1})>=Xe}function H(){return new Date().toLocaleTimeString("en-US",{hour12:!1})>=Ze}const i=t=>Number(t||0).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}),M=()=>{var y,f,v;if(!s.value)return 0;const t=(((y=s.value.earnings)==null?void 0:y.travelExpenses)||0)+(((f=s.value.earnings)==null?void 0:f.otherEarnings)||0),e=s.value.salary||0,a=P(),o=T(),r=q(s.value.payheads||[]),c=((v=$())==null?void 0:v.taxable)||0;return e+t+a+o+r+c},q=t=>Array.isArray(t)?t.filter(e=>e.type==="Earnings").reduce((e,a)=>e+Number(a.amount||0),0):0,K=t=>Array.isArray(t)?t.filter(e=>e.type==="Deductions").reduce((e,a)=>e+Number(a.amount||0),0):0,$=()=>{if(!s.value)return{taxable:0,nonTaxable:0,totalSupplementary:0};const t=s.value.commission||0,e=s.value.profitSharing||0,a=s.value.fees||0,o=s.value.thirteenthMonthPay||0,r=s.value.hazardPay||0,c=T()||0,y=s.value.otherTaxable||0,f=t+e+a+o+r+c+y,v=Math.min(o,9e4),k=Math.max(0,o-9e4);return{taxable:t+e+a+k+r+c+y,nonTaxable:v,totalSupplementary:f}},Q=()=>{if(!s.value)return{totalNonTaxable:0};const t=s.value.salary/30<=S.minimumWage,e=t?s.value.salary:0,a=t?P():0,o=t?T():0,r=t&&s.value.nightShiftDiff||0,c=t&&s.value.hazardPay||0,y=Math.min(s.value.thirteenthMonthPay||0,9e4),f=Math.min(s.value.deMinimis||0,S.deMinimisLimit),v=I(s.value.salary),k=D(s.value.salary),W=N(s.value.salary);return{totalNonTaxable:e+a+o+r+c+y+f+v+k+W}},j=()=>{if(!s.value)return 0;const t=I(s.value.salary),e=D(s.value.salary),a=N(s.value.salary),o=B(),r=K(s.value.payheads||[]);return t+e+a+o+r},X=()=>{if(!s.value)return 0;const t=M(),e=j();return t-e},P=()=>{if(!s.value)return 0;const t=s.value.salary/30,e="2025-03",a=S.regularHolidays.some(r=>r.split("/")[0].padStart(2,"0")+"/"+r.split("/")[1].padStart(2,"0")+"/"+r.split("/")[2]==e.split("-")[1]+"/??/2025"),o=S.specialNonWorkingDays.some(r=>r.split("/")[0].padStart(2,"0")+"/"+r.split("/")[1].padStart(2,"0")+"/"+r.split("/")[2]==e.split("-")[1]+"/??/2025");return a?t*2:o?t*1.3:0},T=()=>{var c,y;if(!s.value)return 0;const t=s.value.salary/(8*22),e=((c=s.value.overtimeHours)==null?void 0:c.regular)||0,a=((y=s.value.overtimeHours)==null?void 0:y.holiday)||0,o=e*t*1.25,r=a*t*1.3;return o+r},I=t=>{const e=Math.min(Math.max(t||0,5e3),35e3);return Math.round(e*.045)},D=t=>{const a=Math.min(t||0,1e5);return Math.round(a*.05/2)},N=t=>{const a=Math.min(t||0,1e4);return Math.round(a*.02)},B=()=>{if(!s.value)return 0;const t=Q().totalNonTaxable,e=M()-t;return e<=20833?0:e<=33333?Math.round((e-20833)*.15):e<=66667?Math.round(1875+(e-33333)*.2):e<=166667?Math.round(13541.8+(e-66667)*.25):e<=666667?Math.round(90841.8+(e-166667)*.3):Math.round(408841.8+(e-666667)*.35)},Z=x(()=>{var t,e,a;return s.value?[{name:"Basic Salary",amount:i(s.value.salary)},{name:"Travel Expenses",amount:i((t=s.value.earnings)==null?void 0:t.travelExpenses)},{name:"Other Earnings",amount:i((e=s.value.earnings)==null?void 0:e.otherEarnings)},{name:"Holiday Pay",amount:i(P())},{name:"Overtime Pay",amount:i(T())},{name:"Supplementary Income",amount:i((a=$())==null?void 0:a.taxable)},...(s.value.payheads||[]).filter(o=>o.type==="Earnings").map(o=>({name:o.name,amount:i(o.amount)}))].filter(o=>o.amount!=="0.00"):[]}),ee=x(()=>s.value?[{name:"SSS",amount:i(I(s.value.salary))},{name:"PhilHealth",amount:i(D(s.value.salary))},{name:"Pag-IBIG",amount:i(N(s.value.salary))},{name:"Withholding Tax",amount:i(B())},...(s.value.payheads||[]).filter(t=>t.type==="Deductions").map(t=>({name:t.name,amount:i(t.amount)}))].filter(t=>t.amount!=="0.00"):[]),te=x(()=>i(M())),ae=x(()=>i(j())),se=x(()=>i(X())),ne=x(()=>{var t,e;return(t=s.value)!=null&&t.firstName&&((e=s.value)!=null&&e.lastName)?`${s.value.firstName[0]}${s.value.lastName[0]}`.toUpperCase():""});function oe(t){return t?new Date(t).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):"--"}function L(t){if(!t)return"--";const[e,a]=t.split(":"),o=parseInt(e)>=12?"PM":"AM";return`${parseInt(e)%12||12}:${a} ${o}`}function re(t){return{"On Time":"text-green-600",Late:"text-yellow-600",Absent:"text-red-600","Early Departure":"text-orange-600"}[t]||"text-gray-600"}return(t,e)=>(m(),d("div",de,[n("div",me,[s.value?(m(),d("div",ye,[n("div",pe,[n("div",he,[n("span",ge,l(ne.value),1)]),n("div",null,[n("h1",fe,l(`${s.value.firstName} ${s.value.lastName}`),1),n("p",ve,"ID: "+l(s.value.empNo)+" | "+l(s.value.position),1)])])])):z("",!0),n("div",xe,[n("div",be,[n("div",_e,[n("div",we,[n("div",Se,"Current Pay Period: "+l(A.value),1),n("div",Te,[n("button",{onClick:V,disabled:b.value||h.value||!R(),class:"bg-emerald-500 text-white px-4 py-2 rounded-lg hover:bg-emerald-600 disabled:bg-gray-400 disabled:cursor-not-allowed"},l(h.value&&!b.value?"Processing...":"Time In"),9,Ee),n("button",{onClick:Y,disabled:!b.value||h.value||!H(),class:"bg-rose-500 text-white px-4 py-2 rounded-lg hover:bg-rose-600 disabled:bg-gray-400 disabled:cursor-not-allowed"},l(h.value&&b.value?"Processing...":"Time Out"),9,Me)])])]),n("div",Pe,[e[2]||(e[2]=n("div",{class:"p-6 border-b border-gray-100"},[n("h2",{class:"text-lg font-semibold text-gray-800"},"My Attendance Records")],-1)),n("div",Ie,[n("table",De,[e[1]||(e[1]=n("thead",{class:"bg-gray-50"},[n("tr",null,[n("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Date "),n("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Time In"),n("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Time Out"),n("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Status")])],-1)),n("tbody",Ne,[(m(!0),d(O,null,C(p.value,a=>(m(),d("tr",{key:a._id,class:"hover:bg-gray-50"},[n("td",ke,l(oe(a.date)),1),n("td",Oe,l(L(a.timeIn)),1),n("td",Ce,l(L(a.timeOut)),1),n("td",Ae,[n("span",{class:ce(re(a.status))},l(a.status),3)])]))),128)),p.value.length?z("",!0):(m(),d("tr",Re,e[0]||(e[0]=[n("td",{colspan:"4",class:"px-6 py-4 text-center text-gray-500"},"No records found ",-1)])))])])])])]),n("div",He,[s.value?(m(),d("div",$e,[n("div",je,[e[3]||(e[3]=n("h2",{class:"text-xl font-semibold text-gray-800"},"Payroll",-1)),n("p",Be,l(A.value),1),n("p",Le,"ID: "+l(s.value.empNo),1)]),n("div",We,[n("div",null,[e[5]||(e[5]=n("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Earnings",-1)),(m(!0),d(O,null,C(Z.value,a=>(m(),d("div",{key:a.name,class:"flex justify-between text-sm py-1"},[n("span",ze,l(a.name),1),n("span",Fe,"₱"+l(a.amount),1)]))),128)),n("div",Ue,[e[4]||(e[4]=n("span",null,"Total Earnings",-1)),n("span",null,"₱"+l(te.value),1)])]),n("div",null,[e[7]||(e[7]=n("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Deductions",-1)),(m(!0),d(O,null,C(ee.value,a=>(m(),d("div",{key:a.name,class:"flex justify-between text-sm py-1"},[n("span",Ge,l(a.name),1),n("span",Je,"₱"+l(a.amount),1)]))),128)),n("div",Ve,[e[6]||(e[6]=n("span",null,"Total Deductions",-1)),n("span",null,"₱"+l(ae.value),1)])]),n("div",Ye,[n("div",qe,[e[8]||(e[8]=n("span",{class:"text-base font-semibold text-gray-800"},"Net Pay",-1)),n("span",Ke,"₱"+l(se.value),1)])])])])):(m(),d("div",Qe," Loading payroll data... "))])])])]))}};export{at as default};
