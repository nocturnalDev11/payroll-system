import{i as g,c as m,o as v,a as e,b as R,w as T,e as h,f as N,g as w,v as S,t as u,n as P,B as F,_ as j,j as C,x as A,k as M,s as B,h as E,G as V,y as U,F as q,m as I,u as z}from"./index-D08fRg5P.js";import{_ as O}from"./Modal-C0QXdCOS.js";const G={class:"p-6"},J={class:"mb-4"},Q={class:"mb-4"},H={class:"mb-4"},K=["disabled"],W={__name:"RequestLeave",props:{show:Boolean,onSubmit:Function},emits:["open","close"],setup(D,{emit:p}){const b=D,d=p,r=g({startDate:"",endDate:"",reason:""}),i=g(!1),l=g(""),x=()=>{const c=localStorage.getItem("token");if(!c)return console.error("No token found in localStorage"),{employeeId:null,token:null};try{const t=JSON.parse(atob(c.split(".")[1]));return t.exp*1e3<Date.now()?(console.error("Token has expired"),{employeeId:null,token:null}):(console.log("Frontend decoded employeeId:",t.employeeId),{employeeId:t.employeeId,token:c})}catch(t){return console.error("Failed to parse token:",t),{employeeId:null,token:null}}},f=async()=>{i.value=!0;const{employeeId:c,token:t}=x();if(console.log("Token:",t),console.log("Employee ID from frontend:",c),!t||!c){l.value="Authentication required. Please log in again.",i.value=!1,setTimeout(()=>l.value="",3e3);return}try{const n=await fetch(`${F}/api/leaves`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({employeeId:c,...r.value,status:"Pending"})});if(!n.ok){const _=await n.text();throw new Error(`Server error: ${_}`)}const L=await n.json();l.value="Request submitted successfully!",y(),b.onSubmit&&b.onSubmit(L),d("close")}catch(n){console.error("Failed to submit leave request:",n),l.value=n.message||"Failed to submit leave request. Please try again."}finally{i.value=!1,setTimeout(()=>l.value="",3e3)}},y=()=>{r.value={startDate:"",endDate:"",reason:""}},k=()=>{d("close"),y()};return(c,t)=>(v(),m("div",null,[e("button",{onClick:t[0]||(t[0]=n=>c.$emit("open")),class:"inline-flex items-center gap-2 bg-blue-500 text-white px-3 py-1.5 rounded-md text-sm font-medium hover:bg-blue-600 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5"}," Request Leave "),R(O,{show:D.show,onClose:k},{default:T(()=>[e("div",G,[e("div",{class:"flex items-center justify-between"},[t[5]||(t[5]=e("h2",{class:"text-2xl font-bold text-gray-900"},"Request Leave",-1)),e("button",{onClick:k,class:"p-2"},t[4]||(t[4]=[e("span",{class:"material-icons text-sm"},"close",-1)]))]),e("form",{onSubmit:N(f,["prevent"])},[e("div",J,[t[6]||(t[6]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Start Date:",-1)),w(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=n=>r.value.startDate=n),class:"w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200 focus:border-blue-300 outline-none",required:""},null,512),[[S,r.value.startDate]])]),e("div",Q,[t[7]||(t[7]=e("label",{class:"block text-gray-700 font-medium mb-2"},"End Date:",-1)),w(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=n=>r.value.endDate=n),class:"w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200 focus:border-blue-300 outline-none",required:""},null,512),[[S,r.value.endDate]])]),e("div",H,[t[8]||(t[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Reason for Leave:",-1)),w(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=n=>r.value.reason=n),class:"w-full p-2 border border-gray-300 rounded-lg focus:ring focus:ring-blue-200 focus:border-blue-300 outline-none min-h-[100px]",required:""},null,512),[[S,r.value.reason]])]),e("button",{type:"submit",class:"w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-all duration-200 font-medium",disabled:i.value},u(i.value?"Submitting...":"Send Request"),9,K)],32),l.value?(v(),m("div",{key:0,class:P([l.value.includes("successfully")?"bg-green-50 text-green-700":"bg-red-50 text-red-700","mt-4 p-3 rounded-lg text-center"])},u(l.value),3)):h("",!0)])]),_:1},8,["show"])]))}},X={class:"min-h-screen p-1"},Y={class:"max-w-8xl mx-auto"},Z={class:"flex justify-between items-center mb-8"},ee={class:"mb-6"},te={class:"bg-white p-6 rounded-2xl shadow-lg transform transition-all hover:shadow-xl"},oe={class:"space-y-6"},se={key:0,class:"p-4 bg-green-100 text-green-700 rounded-lg text-center animate-bounce-in"},ae={key:1,class:"text-center py-12 text-gray-500"},le=["onClick"],ne={class:"flex justify-between items-start gap-4"},re={class:"flex-1"},ie={class:"text-lg font-semibold text-gray-800 group-hover:text-indigo-600 transition-colors"},ue={class:"text-sm text-gray-600"},de={class:"mt-2 text-gray-700 line-clamp-2"},ce={class:"flex-shrink-0"},ve={key:2,class:"mt-8 flex justify-between items-center flex-wrap gap-4"},me={class:"flex items-center gap-2 text-sm text-gray-600"},ge=["value"],pe={class:"flex items-center gap-2"},be=["disabled"],fe={class:"text-gray-700"},ye=["disabled"],xe={__name:"EmployeeLeaveRequest",setup(D){const p=g(!1),b=g([]),d=g(1),r=g(5),i=g(""),l=g(""),x=C(()=>Math.ceil(f.value.length/r.value)),f=C(()=>b.value.filter(a=>a.employeeName.toLowerCase().includes(l.value.toLowerCase())||a.reason.toLowerCase().includes(l.value.toLowerCase())||a.status.toLowerCase().includes(l.value.toLowerCase()))),y=C(()=>{const a=(d.value-1)*r.value,o=a+r.value;return f.value.slice(a,o)}),k=()=>{const a=localStorage.getItem("token");if(!a)return console.error("No token found in localStorage"),{employeeId:null,token:null};try{const o=JSON.parse(atob(a.split(".")[1]));return o.exp*1e3<Date.now()?(console.error("Token has expired"),z().logout(),{employeeId:null,token:null}):{employeeId:o.employeeId,token:a}}catch(o){return console.error("Failed to parse token:",o),{employeeId:null,token:null}}},c=async()=>{const{employeeId:a,token:o}=k();if(!a||!o){i.value="Authentication required. Please log in again.",setTimeout(()=>i.value="",3e3);return}try{const s=await fetch(`${F}/api/leaves/employee/${a}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!s.ok){const $=await s.text();throw new Error(`Failed to fetch leave requests: ${$}`)}b.value=await s.json()||[]}catch(s){console.error("Failed to fetch leave requests:",s),i.value="Failed to load leave requests. Please try again.",setTimeout(()=>i.value="",3e3)}},t=a=>{b.value.unshift(a),d.value=1,i.value="Leave request submitted successfully!",setTimeout(()=>i.value="",3e3)},n=()=>{d.value<x.value&&d.value++},L=()=>{d.value>1&&d.value--},_=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return A(l,()=>{d.value=1}),M(()=>{c()}),(a,o)=>(v(),m("div",X,[e("div",Y,[e("div",Z,[o[5]||(o[5]=e("h1",{class:"text-4xl font-bold text-gray-900 animate-fade-in"},"My Leave Management",-1)),e("button",{onClick:o[0]||(o[0]=s=>p.value=!0),class:"bg-indigo-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 flex items-center gap-2 animate-pulse-once"},o[4]||(o[4]=[e("span",{class:"material-icons-outlined"},"add",-1),E(" Request Leave ")]))]),e("div",ee,[w(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>l.value=s),type:"text",class:"w-full md:w-1/2 lg:w-1/3 p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all duration-300 placeholder-gray-400 shadow-sm",placeholder:"Search by name, reason, or status..."},null,512),[[S,l.value]])]),e("div",te,[e("div",oe,[i.value?(v(),m("div",se,u(i.value),1)):h("",!0),y.value.length===0?(v(),m("div",ae,[o[6]||(o[6]=e("span",{class:"material-icons-outlined text-4xl text-gray-400 mb-2"},"event_busy",-1)),e("p",null,"No leave requests found."+u(l.value?" Try adjusting your search.":""),1)])):h("",!0),R(V,{name:"list",tag:"div",class:"grid gap-4"},{default:T(()=>[(v(!0),m(q,null,I(y.value,s=>(v(),m("div",{key:s._id,class:"border border-gray-200 rounded-xl p-5 bg-gray-50 hover:bg-gray-100 transition-all duration-300 transform hover:-translate-y-1 hover:shadow-md cursor-pointer group",onClick:$=>a.$emit("view-details",s)},[e("div",ne,[e("div",re,[e("h3",ie,u(s.employeeName),1),e("p",ue,u(_(s.startDate))+" - "+u(_(s.endDate)),1),e("p",de,u(s.reason),1)]),e("div",ce,[e("span",{class:P([{"bg-yellow-100 text-yellow-700":s.status==="Pending","bg-green-100 text-green-700":s.status==="Approved","bg-red-100 text-red-700":s.status==="Disapproved"},"px-3 py-1 rounded-full text-sm font-medium relative group-hover:scale-105 transition-transform"])},u(s.status),3)])])],8,le))),128))]),_:1}),f.value.length>0?(v(),m("div",ve,[e("div",me,[e("span",null,"Showing "+u(y.value.length)+" of "+u(f.value.length)+" requests",1),w(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>r.value=s),class:"border border-gray-300 rounded-lg p-1"},[(v(),m(q,null,I([5,10,20],s=>e("option",{key:s,value:s},u(s)+" per page",9,ge)),64))],512),[[U,r.value,void 0,{number:!0}]])]),e("div",pe,[e("button",{onClick:L,disabled:d.value===1,class:"px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"},o[7]||(o[7]=[e("span",{class:"material-icons-outlined"},"chevron_left",-1)]),8,be),e("span",fe,u(d.value)+" of "+u(x.value),1),e("button",{onClick:n,disabled:d.value===x.value,class:"px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"},o[8]||(o[8]=[e("span",{class:"material-icons-outlined"},"chevron_right",-1)]),8,ye)])])):h("",!0)])]),p.value?(v(),B(W,{key:0,show:p.value,onClose:o[3]||(o[3]=s=>p.value=!1),onSubmit:t,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},null,8,["show"])):h("",!0)])]))}},ke=j(xe,[["__scopeId","data-v-66155869"]]);export{ke as default};
