import{C as j,u as F,B as A,c as y,o as x,a as e,b as R,w as L,h as g,t as i,n as P,F as N,_ as M,i as $,j as B,k as U,D as E,m as C,q as V,f as q}from"./index-D08fRg5P.js";import{_ as H}from"./Modal-C0QXdCOS.js";const z=j("attendance",{state:()=>({attendanceRecords:[],loading:!1,error:null}),actions:{async timeIn(a){try{const o=await fetch(`${A}/api/attendance/time-in`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employeeId:a})});if(!o.ok)throw new Error(await o.text());const m=await o.json();return this.attendanceRecords.push(m),m}catch(o){throw this.error=o.message||"Failed to time in",new Error(this.error)}},async timeOut(a){try{const o=await fetch(`${A}/api/attendance/time-out`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employeeId:a})});if(!o.ok)throw new Error(await o.text());const m=await o.json();this.attendanceRecords=this.attendanceRecords.map(p=>p._id===m._id?m:p)}catch(o){this.error=o.message||"Failed to time out"}},async fetchAttendance(){this.loading=!0,this.error=null;const a=F();try{const o=await fetch(`${A}/api/attendance?date=${new Date().toISOString().split("T")[0]}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.accessToken}`}});if(!o.ok)throw new Error(await o.text());const m=await o.json();this.attendanceRecords=m}catch(o){this.error=o.message||"Failed to fetch attendance records",console.error(this.error)}finally{this.loading=!1}}}}),G={class:"p-6 border-b border-gray-200 flex justify-between items-center"},J={class:"p-6 space-y-4"},K={class:"flex items-center gap-3"},Q=["src"],W={class:"text-base font-medium text-gray-800"},X={class:"text-sm text-gray-600"},Y={__name:"EmployeeAttendanceDetails",props:{show:{type:Boolean,required:!0},employee:{type:Object,default:()=>({})}},emits:["close","open"],setup(a,{emit:o}){const m=o,p=u=>{if(!u)return"N/A";const[n,h]=u.split(":"),w=n>=12?"PM":"AM";return`${n%12||12}:${h} ${w}`},f=u=>{switch(u==null?void 0:u.toLowerCase()){case"on time":case"present":return"text-green-600 font-medium";case"late":return"text-yellow-600 font-medium";case"absent":return"text-red-600 font-medium";default:return"text-gray-600"}},v=()=>{m("open")};return(u,n)=>(x(),y(N,null,[e("button",{onClick:v,class:"text-blue-600 hover:text-blue-800 transition cursor-pointer",title:"View Details"},n[2]||(n[2]=[e("span",{class:"material-icons"},"visibility",-1)])),R(H,{show:a.show,onClose:n[1]||(n[1]=h=>m("close"))},{default:L(()=>{var h,w,b,T,_,k,S,l,t,s,r,d;return[e("div",G,[n[4]||(n[4]=e("h2",{class:"text-xl font-bold text-gray-900 flex items-center"},[e("span",{class:"material-icons mr-2"},"person"),g(" Employee Details ")],-1)),e("button",{onClick:n[0]||(n[0]=c=>m("close")),class:"text-gray-400 hover:text-gray-800 cursor-pointer"},n[3]||(n[3]=[e("span",{class:"material-icons"},"close",-1)]))]),e("div",J,[e("div",K,[e("img",{src:`https://ui-avatars.com/api/?name=${(w=(h=a.employee.employeeId)==null?void 0:h.firstName)==null?void 0:w.charAt(0)}${(T=(b=a.employee.employeeId)==null?void 0:b.lastName)==null?void 0:T.charAt(0)}&background=random&color=fff`,alt:"Employee avatar",class:"h-12 w-12 rounded-full object-cover border border-gray-200",loading:"lazy"},null,8,Q),e("div",null,[e("p",W,i(((_=a.employee.employeeId)==null?void 0:_.firstName)||"")+" "+i(((k=a.employee.employeeId)==null?void 0:k.lastName)||""),1),e("p",X,i(((S=a.employee.employeeId)==null?void 0:S.position)||"N/A"),1)])]),e("p",null,[n[5]||(n[5]=e("strong",null,"ID:",-1)),g(" "+i(((l=a.employee.employeeId)==null?void 0:l.employeeIdNumber)||a.employee.employeeId||"N/A"),1)]),e("p",null,[n[6]||(n[6]=e("strong",null,"Name:",-1)),g(" "+i(((t=a.employee.employeeId)==null?void 0:t.firstName)||"")+" "+i(((s=a.employee.employeeId)==null?void 0:s.lastName)||""),1)]),e("p",null,[n[7]||(n[7]=e("strong",null,"Position:",-1)),g(" "+i(((r=a.employee.employeeId)==null?void 0:r.position)||"N/A"),1)]),e("p",null,[n[8]||(n[8]=e("strong",null,"Email:",-1)),g(" "+i(((d=a.employee.employeeId)==null?void 0:d.email)||a.employee.email||"N/A"),1)]),e("p",null,[n[9]||(n[9]=e("strong",null,"Sign In Time:",-1)),g(" "+i(p(a.employee.timeIn||a.employee.signInTime)),1)]),e("p",null,[n[10]||(n[10]=e("strong",null,"Sign Out Time:",-1)),g(" "+i(p(a.employee.timeOut||a.employee.signOutTime)),1)]),e("p",null,[n[11]||(n[11]=e("strong",null,"Status: ",-1)),e("span",{class:P(f(a.employee.status))},i(a.employee.status||"Absent"),3)])])]}),_:1},8,["show"])],64))}},Z={class:"min-h-screen bg-gray-50"},ee={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},te={class:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4"},se={class:"bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1"},ne={class:"p-6"},oe={class:"flex items-center"},ae={class:"ml-5"},le={class:"text-2xl font-bold text-gray-900"},ie={class:"bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1"},re={class:"flex items-center p-6 gap-4"},de={class:"text-2xl font-bold text-gray-900"},ce={class:"bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1"},me={class:"p-6"},pe={class:"flex items-center"},ue={class:"ml-5"},ye={class:"text-2xl font-bold text-gray-900"},xe={class:"bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1"},ge={class:"p-6"},he={class:"flex items-center"},fe={class:"ml-5"},we={class:"text-2xl font-bold text-gray-900"},ve={class:"mt-8 flex space-x-4"},be=["disabled"],Ie={key:0,class:"animate-spin material-icons"},Ae={key:1,class:"material-icons"},Te=["disabled"],_e=["disabled"],ke={class:"mt-8 bg-white rounded-xl shadow-sm overflow-hidden"},Se={class:"overflow-x-auto"},$e={class:"w-full"},Ne={class:"divide-y divide-gray-200"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Re={class:"px-6 py-4 text-sm"},Pe={class:"flex space-x-2"},je=["onClick"],Fe={__name:"AdminDashboard",setup(a){V();const o=z(),m=$(0),p=$(!1),f=$(!1),v=$({}),u=async()=>{try{const l=await fetch(`${A}/api/employees/total`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw new Error("Failed to fetch total employees");const t=await l.json();m.value=t.total}catch(l){console.error("Failed to fetch total employees:",l)}},n=l=>{if(!l)return"--";const[t,s]=l.split(":"),r=t>=12?"PM":"AM";return`${t%12||12}:${s} ${r}`},h=async()=>{p.value=!0;try{await o.fetchAttendance()}catch(l){console.error("Failed to refresh attendance:",l)}finally{p.value=!1}},w=()=>{const l=new Date().toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),t=[["Date","Employee ID","Name","Position","Sign In Time","Sign Out Time","Status"],...o.attendanceRecords.map(d=>{var c,I,O,D;return[l,((c=d.employeeId)==null?void 0:c.employeeIdNumber)||"N/A",`${(I=d.employeeId)==null?void 0:I.firstName} ${(O=d.employeeId)==null?void 0:O.lastName}`,((D=d.employeeId)==null?void 0:D.position)||"N/A",n(d.timeIn),n(d.timeOut),d.status||"N/A"]})].map(d=>d.join(",")).join(`
`),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=`attendance_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r)},b=async()=>{f.value=!0;try{console.log("Processing payroll..."),await new Promise(l=>setTimeout(l,1e3))}finally{f.value=!1}},T=async l=>{if(confirm("Are you sure you want to delete this attendance record?"))try{if(!(await fetch(`${A}/api/attendance/${l}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete attendance");await o.fetchAttendance()}catch(t){console.error("Failed to delete attendance:",t)}},_=l=>{v.value[l]=!0},k=l=>{v.value[l]=!1},S=B(()=>{if(new Date().toLocaleTimeString("en-US",{hour12:!1})>"13:00:00"){const s=o.attendanceRecords.filter(c=>c.timeIn&&c.status!=="Absent").map(c=>c.employeeId._id.toString()),r=o.attendanceRecords.map(c=>c.employeeId._id.toString());return[...new Set(r.filter(c=>!s.includes(c)))].length}return o.attendanceRecords.filter(s=>s.status==="Absent").length});return U(()=>{u(),o.fetchAttendance()}),(l,t)=>(x(),y("div",Z,[e("div",ee,[e("div",te,[e("div",se,[e("div",ne,[e("div",oe,[t[1]||(t[1]=e("div",{class:"rounded-full bg-indigo-100 p-3"},[e("span",{class:"material-icons text-indigo-600"},"groups")],-1)),e("div",ae,[t[0]||(t[0]=e("p",{class:"text-sm font-medium text-gray-600"},"Total Employees",-1)),e("h3",le,i(m.value),1)])])])]),e("div",ie,[e("div",re,[t[3]||(t[3]=e("div",{class:"rounded-full bg-green-100 p-3"},[e("span",{class:"material-icons text-green-600"},"how_to_reg")],-1)),e("div",null,[t[2]||(t[2]=e("p",{class:"text-sm font-medium text-gray-600"},"Present Today",-1)),e("h3",de,i(E(o).attendanceRecords.filter(s=>s.status==="On Time").length),1)])])]),e("div",ce,[e("div",me,[e("div",pe,[t[5]||(t[5]=e("div",{class:"rounded-full bg-yellow-100 p-3"},[e("span",{class:"material-icons text-yellow-600"},"schedule")],-1)),e("div",ue,[t[4]||(t[4]=e("p",{class:"text-sm font-medium text-gray-600"},"Late Today",-1)),e("h3",ye,i(E(o).attendanceRecords.filter(s=>s.status==="Late").length),1)])])])]),e("div",xe,[e("div",ge,[e("div",he,[t[7]||(t[7]=e("div",{class:"rounded-full bg-red-100 p-3"},[e("span",{class:"material-icons text-red-600"},"cancel")],-1)),e("div",fe,[t[6]||(t[6]=e("p",{class:"text-sm font-medium text-gray-600"},"Absent Today",-1)),e("h3",we,i(S.value),1)])])])])]),e("div",ve,[e("button",{onClick:h,class:"flex items-center space-x-2 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors cursor-pointer",disabled:p.value},[p.value?(x(),y("span",Ie,"refresh")):(x(),y("span",Ae,"refresh")),t[8]||(t[8]=e("span",null,"Refresh Data",-1))],8,be),e("button",{onClick:w,class:"flex items-center space-x-2 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors cursor-pointer",disabled:p.value},t[9]||(t[9]=[e("span",{class:"material-icons"},"download",-1),e("span",null,"Export CSV",-1)]),8,Te),e("button",{onClick:b,class:"flex items-center space-x-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",disabled:f.value},[t[10]||(t[10]=e("span",{class:"material-icons"},"payment",-1)),e("span",null,i(f.value?"Processing...":"Process Payroll"),1)],8,_e)]),e("div",ke,[t[14]||(t[14]=e("div",{class:"p-6 border-b border-gray-300"},[e("h2",{class:"text-xl font-bold text-gray-900 flex items-center"},[e("span",{class:"material-icons mr-2"},"event_note"),g(" Today's Attendance ")])],-1)),e("div",Se,[e("table",$e,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("div",{class:"flex items-center space-x-2"},[e("span",{class:"material-icons text-gray-400"},"badge"),e("span",null,"Employee")])]),e("th",{class:"px-6 py-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("div",{class:"flex items-center space-x-2"},[e("span",{class:"material-icons text-gray-400"},"work"),e("span",null,"Position")])]),e("th",{class:"px-6 py-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("div",{class:"flex items-center space-x-2"},[e("span",{class:"material-icons text-gray-400"},"login"),e("span",null,"Sign In")])]),e("th",{class:"px-6 py-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("div",{class:"flex items-center space-x-2"},[e("span",{class:"material-icons text-gray-400"},"logout"),e("span",null,"Sign Out")])]),e("th",{class:"px-6 py-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("div",{class:"flex items-center space-x-2"},[e("span",{class:"material-icons text-gray-400"},"info"),e("span",null,"Status")])]),e("th",{class:"px-6 py-4 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("div",{class:"flex items-center space-x-2"},[e("span",{class:"material-icons text-gray-400"},"settings"),e("span",null,"Actions")])])])],-1)),e("tbody",Ne,[p.value?(x(),y(N,{key:0},C(5,s=>e("tr",{key:s,class:"animate-pulse"},[(x(),y(N,null,C(6,r=>e("td",{key:r,class:"px-6 py-4"},t[11]||(t[11]=[e("div",{class:"h-4 bg-gray-200 rounded"},null,-1)]))),64))])),64)):(x(!0),y(N,{key:1},C(E(o).attendanceRecords,s=>{var r,d,c;return x(),y("tr",{key:s._id,class:"hover:bg-gray-50"},[e("td",Ee,i((r=s.employeeId)==null?void 0:r.firstName)+" "+i((d=s.employeeId)==null?void 0:d.lastName),1),e("td",Ce,i(((c=s.employeeId)==null?void 0:c.position)||"N/A"),1),e("td",Oe,i(n(s.timeIn)),1),e("td",De,i(n(s.timeOut)),1),e("td",{class:P(["px-6 py-4 whitespace-nowrap text-left text-sm font-medium",{"text-red-500":s.status==="Absent","text-green-500":s.status==="On Time","text-yellow-500":s.status==="Late","text-orange-500":s.status==="Early Departure"}])},i(s.status||"N/A"),3),e("td",Re,[e("div",Pe,[R(Y,{show:v.value[s._id]||!1,employee:s,onOpen:I=>_(s._id),onClose:I=>k(s._id)},null,8,["show","employee","onOpen","onClose"]),e("button",{onClick:q(I=>T(s._id),["stop"]),class:"text-red-600 hover:text-red-800 transition cursor-pointer",title:"Delete Record"},t[12]||(t[12]=[e("span",{class:"material-icons"},"delete",-1)]),8,je)])])])}),128))])])])])])]))}},Be=M(Fe,[["__scopeId","data-v-e6e94f00"]]);export{Be as default};
