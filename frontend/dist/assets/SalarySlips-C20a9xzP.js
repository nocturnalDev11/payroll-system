import{a as Y}from"./index-t--hEgTQ.js";import{E as L,a as W}from"./jspdf.plugin.autotable-DhtfI_9i.js";import{h}from"./moment-C5S46NFB.js";import{_ as G,c as g,a as i,e as S,g as H,v as z,h as f,t as p,F as k,m as A,f as _,y as F,E as U,n as I,u as B,o as m}from"./index-D08fRg5P.js";L.prototype.autoTable=W.default;const O={name:"SalarySlips",data(){return{employees:[],positions:[],searchQuery:"",currentPage:1,itemsPerPage:10,payslipGenerationStatus:{},isLoading:!1,isGeneratingAll:!1,statusMessage:"",showHistoryModal:!1,selectedEmployee:null,selectedPayslip:null,payslipHistory:[],allPayslipHistories:{},iframeError:!1,config:{minimumWage:0,deMinimisLimit:0,regularHolidays:[],specialNonWorkingDays:[]},showPrintAllModal:!1,employeesWithPayslips:[],selectedEmployeesForPrint:[],isPrinting:!1,selectAll:!1,showUpdateModal:!1,selectedEmployeeForUpdate:"",newPosition:"",sortPreviousField:"payDate",sortPreviousAsc:!0,sortNewField:"payDate",sortNewAsc:!0,currentDate:new Date("2025-03-17")}},setup(){return{authStore:B()}},computed:{filteredEmployees(){return this.employees.filter(t=>(t&&t.name?t.name:"").toLowerCase().includes(this.searchQuery.toLowerCase()))},totalPages(){return Math.ceil(this.filteredEmployees.length/this.itemsPerPage)||1},paginatedEmployees(){const t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.filteredEmployees.slice(t,e).sort((o,n)=>o.position.localeCompare(n.position))},sortedPositionHistory(){var t,e,o;return!this.selectedEmployee||!this.selectedEmployee.positionHistory?[{position:((t=this.selectedEmployee)==null?void 0:t.position)||"N/A",salary:((e=this.selectedEmployee)==null?void 0:e.salary)||0,startDate:((o=this.selectedEmployee)==null?void 0:o.hireDate)||this.currentDate.toISOString().split("T")[0],endDate:null}]:[...this.selectedEmployee.positionHistory].sort((n,a)=>new Date(n.startDate)-new Date(a.startDate))},initialPosition(){return this.sortedPositionHistory[0]},latestPosition(){return this.sortedPositionHistory[this.sortedPositionHistory.length-1]},hasUpdatedPosition(){return this.sortedPositionHistory.length>1},sortedPreviousPayslips(){return this.payslipHistory.filter(e=>e.position===this.initialPosition.position).sort((e,o)=>{if(this.sortPreviousField==="payDate"){const n=h(e.paydayType==="mid-month"?e.expectedPaydays.midMonthPayday:e.expectedPaydays.endMonthPayday,"D MMMM YYYY"),a=h(o.paydayType==="mid-month"?o.expectedPaydays.midMonthPayday:o.expectedPaydays.endMonthPayday,"D MMMM YYYY");return this.sortPreviousAsc?n-a:a-n}else if(this.sortPreviousField==="position"){const n=this.getPositionName(e.position),a=this.getPositionName(o.position);return this.sortPreviousAsc?n.localeCompare(a):a.localeCompare(n)}return 0})},sortedNewPayslips(){return this.payslipHistory.filter(e=>e.position===this.latestPosition.position&&this.hasUpdatedPosition&&h(e.salaryMonth,"YYYY-MM").isSameOrAfter(h(this.latestPosition.startDate,"YYYY-MM-DD"),"month")).sort((e,o)=>{if(this.sortNewField==="payDate"){const n=h(e.paydayType==="mid-month"?e.expectedPaydays.midMonthPayday:e.expectedPaydays.endMonthPayday,"D MMMM YYYY"),a=h(o.paydayType==="mid-month"?o.expectedPaydays.midMonthPayday:o.expectedPaydays.endMonthPayday,"D MMMM YYYY");return this.sortNewAsc?n-a:a-n}else if(this.sortNewField==="position"){const n=this.getPositionName(e.position),a=this.getPositionName(o.position);return this.sortNewAsc?n.localeCompare(a):a.localeCompare(n)}return 0})}},async created(){if(!this.authStore.isAuthenticated||!this.authStore.isAdmin){console.error("User is not authenticated as admin. Redirecting to login..."),this.showErrorMessage("Please log in as an admin to access this page."),this.$router.push("/admin-login");return}this.isLoading=!0;try{await this.fetchConfig(),await this.fetchPositionsWithRetry(),await this.fetchEmployees()}catch(t){console.error("Error in created hook:",t),this.showErrorMessage("Failed to initialize component. Please try again.")}finally{this.isLoading=!1}},methods:{async fetchConfig(){try{const t=this.authStore.accessToken||localStorage.getItem("token");if(!t)throw new Error("No authentication token found");const e=await Y.get("http://localhost:7777/api/config",{headers:{Authorization:`Bearer ${t}`,"user-role":"admin"}});this.config={minimumWage:e.data.minimumWage||610,deMinimisLimit:e.data.deMinimisLimit||1e4,regularHolidays:e.data.regularHolidays||[],specialNonWorkingDays:e.data.specialNonWorkingDays||[]}}catch(t){console.error("Error fetching config:",t),this.showErrorMessage("Failed to load configuration. Using defaults."),this.config={minimumWage:610,deMinimisLimit:1e4,regularHolidays:[],specialNonWorkingDays:[]}}},async fetchPositionsWithRetry(t=3,e=1e3){var o;for(let n=0;n<t;n++)try{const a=((o=this.authStore.admin)==null?void 0:o._id)||localStorage.getItem("userId")||"",r=this.authStore.accessToken||localStorage.getItem("token")||"";if(!r)throw new Error("No authentication token found");console.log("Fetching positions with:",{userId:a,token:r.slice(0,20)+"..."});const d=await Y.get("http://localhost:7777/api/positions",{headers:{Authorization:`Bearer ${r}`,"user-role":"admin","user-id":a}});this.positions=d.data.map(s=>({name:s.name,salary:s.salary}));return}catch(a){console.error(`Attempt ${n+1} to fetch positions failed:`,a),n===t-1?this.showErrorMessage("Failed to load positions after multiple attempts."):await new Promise(r=>setTimeout(r,e))}},getPositionName(t){const e=this.positions.find(o=>o.name.trim().toLowerCase()===(t==null?void 0:t.trim().toLowerCase()));return e?e.name:t||"Unknown Position"},getPositionSalary(t){const e=this.positions.find(o=>o.name.trim().toLowerCase()===(t==null?void 0:t.trim().toLowerCase()));return e?e.salary:0},getHourlyRate(t){return this.getPositionSalary(t)/(8*22)},async fetchEmployees(){var o;this.isLoading=!0,this.statusMessage="";const t=((o=this.authStore.admin)==null?void 0:o._id)||localStorage.getItem("userId")||"",e=this.authStore.accessToken||localStorage.getItem("token")||"";console.log("Fetching employees with:",{userId:t,token:e.slice(0,20)+"..."});try{if(!e)throw new Error("No authentication token found");const n=await Y.get("http://localhost:7777/api/employees",{headers:{Authorization:`Bearer ${e}`,"user-role":"admin","user-id":t}});this.employees=n.data.map(a=>{const r=this.getLatestPosition(a),d=`${a.firstName||""} ${a.lastName||""}`.trim()||"Unnamed Employee";return{...a,id:a._id,name:d,position:r.position,salary:r.salary,positionHistory:Array.isArray(a.positionHistory)&&a.positionHistory.length>0?a.positionHistory:[{position:a.position||"N/A",salary:a.salary||0,startDate:a.hireDate||this.currentDate.toISOString().split("T")[0],endDate:null}],createdAt:a.createdAt||a.hireDate,updatedAt:a.updatedAt}}),this.showSuccessMessage("Employees loaded successfully!")}catch(n){console.error("Error fetching employees:",n),this.showErrorMessage(`Failed to load employees: ${n.message}`)}finally{this.isLoading=!1}},async refreshData(){this.isLoading=!0;try{await this.fetchConfig(),await this.fetchPositionsWithRetry(),await this.fetchEmployees(),this.showHistoryModal&&this.selectedEmployee&&await this.showPayslipHistory(this.selectedEmployee)}catch(t){console.error("Error refreshing data:",t),this.showErrorMessage(`Failed to refresh data: ${t.message}`)}finally{this.isLoading=!1}},async showPayslipHistory(t){if(this.isLoading=!0,!t||!t.id||!t.empNo){this.showErrorMessage("Invalid employee data"),console.error("Invalid employee:",t),this.isLoading=!1;return}const e=this.authStore.accessToken||localStorage.getItem("token");if(!e){this.showErrorMessage("Authentication required. Please log in."),this.$router.push("/admin-login");return}this.selectedEmployee={...t,positionHistory:Array.isArray(t.positionHistory)&&t.positionHistory.length>0?t.positionHistory:[{position:t.position||"N/A",salary:t.salary||0,startDate:t.hireDate||this.currentDate.toISOString().split("T")[0],endDate:null}]};const o=h(this.currentDate),n=h(this.selectedEmployee.hireDate||this.currentDate);let a=[];try{a=(await Y.get(`http://localhost:7777/api/payslips/${this.selectedEmployee.id}`,{headers:{Authorization:`Bearer ${e}`,"user-role":"admin"}})).data||[],console.log("Fetched backend payslips:",a)}catch(s){console.error("Error fetching payslips:",s)}const r=[];let d=n.clone();for(;d.isSameOrBefore(o,"day");){const s=d.format("YYYY-MM"),u=this.getExpectedPayday(n.toDate(),s),l=d.clone(),c=this.getActivePositionForDate(this.selectedEmployee.positionHistory,l),y=l.date()===15?"mid-month":"end-of-month",P=a.find(N=>N.salaryMonth===s&&N.paydayType===y&&h(N.payDate).isSame(l,"day"))||{},D={salaryMonth:s,paydayType:y,payDate:l.format("YYYY-MM-DD"),position:c.position,salary:c.salary,totalSalary:P.salary?this.calculateNetSalary({...this.selectedEmployee,position:c.position,salary:c.salary}):null,payslipDataUrl:P.payslipData?`data:application/pdf;base64,${P.payslipData}`:null,employee:{...this.selectedEmployee,position:c.position,salary:c.salary,salaryMonth:l.format("YYYY-MM-DD")},expectedPaydays:u};r.push(D),!D.payslipDataUrl&&o.isSameOrAfter(l,"day")&&await this.generatePayslip(D),d.add(15,"days")}this.allPayslipHistories[this.selectedEmployee.id]=r,this.payslipHistory=r,this.selectedPayslip=r.find(s=>s.payslipDataUrl)||r[0]||null,this.showHistoryModal=!0,this.isLoading=!1},canGeneratePayslip(t){const e=h(this.currentDate),o=h(t.paydayType==="mid-month"?t.expectedPaydays.midMonthPayday:t.expectedPaydays.endMonthPayday,"D MMMM YYYY");return e.isSameOrAfter(o,"day")&&!t.payslipDataUrl},async generatePayslip(t){const e=t.employee;if(!e||!e.id||!e.empNo){this.showErrorMessage("Employee data is incomplete."),console.error("Invalid employee data:",e);return}const o=h(t.paydayType==="mid-month"?`${t.salaryMonth}-15`:`${t.salaryMonth}-${h(t.salaryMonth).daysInMonth()}`,"YYYY-MM-DD");if(!o.isValid()){this.showErrorMessage("Invalid pay date calculated."),console.error("Invalid payDate:",t.salaryMonth,t.paydayType);return}const n=Array.isArray(e.positionHistory)?e.positionHistory:[],a=this.getActivePositionForDate(n,o);if(!a||!a.position||a.salary===void 0){this.showErrorMessage("Invalid position or salary for this date."),console.error("Invalid activePosition:",a,"Position History:",n);return}const r={...e,position:a.position,salary:a.salary},d=`${t.salaryMonth}-${t.paydayType}`;this.payslipGenerationStatus[d]={generating:!0};try{const s=this.createPayslipData(r),u=await this.generatePdf(s),l=await this.blobToBase64(u),c=URL.createObjectURL(u),y={employeeId:e.id,empNo:String(e.empNo),payslipData:l.split(",")[1],salaryMonth:t.salaryMonth,paydayType:t.paydayType,position:a.position,salary:Number(a.salary)};if(console.log("Sending payload to backend:",y),!y.employeeId||!y.empNo||!y.payslipData||!y.salaryMonth||!y.paydayType||!y.position||y.salary===void 0||isNaN(y.salary))throw new Error("Payload is missing required fields or contains invalid data");const P=this.authStore.accessToken||localStorage.getItem("token");if(!P)throw new Error("No authentication token available. Please log in.");const D=await Y.post("http://localhost:7777/api/payslips/generate",y,{headers:{Authorization:`Bearer ${P}`,"user-role":"admin"}});if(console.log("Payslip generated successfully:",D.data),D.status===201||D.status===200){t.payslipDataUrl=c,t.position=a.position,t.salary=a.salary,t.totalSalary=this.calculateNetSalary(r),this.selectedPayslip=t;const N=this.allPayslipHistories[e.id]||[],w=N.map(E=>E.salaryMonth===t.salaryMonth&&E.paydayType===t.paydayType?t:E);N.some(E=>E.salaryMonth===t.salaryMonth&&E.paydayType===t.paydayType)||w.push(t),this.allPayslipHistories[e.id]=w,this.payslipHistory=w,this.showSuccessMessage(`Payslip generated for ${e.name} - ${t.paydayType==="mid-month"?t.expectedPaydays.midMonthPayday:t.expectedPaydays.endMonthPayday}!`)}}catch(s){console.error("Error generating payslip:",s),this.showErrorMessage(`Failed to generate payslip: ${s.message}`),s.response&&console.error("Backend response:",s.response.data),s.message==="No authentication token available. Please log in."&&this.$router.push("/admin-login")}finally{this.payslipGenerationStatus[d]={generating:!1}}},async generateAllPayslips(){this.isGeneratingAll=!0,this.statusMessage="";try{for(const e of this.employees)this.allPayslipHistories[e.id]||(await this.showPayslipHistory(e),this.showHistoryModal=!1);const t=[];for(const e of this.employees){const n=(this.allPayslipHistories[e.id]||[]).filter(a=>this.canGeneratePayslip(a));t.push(...n)}if(t.length===0){this.showErrorMessage("No payslips are due for generation.");return}for(const e of t)await this.generatePayslip(e);this.showSuccessMessage(`Generated ${t.length} payslips successfully!`)}catch(t){console.error("Error generating all payslips:",t),this.showErrorMessage(`Failed to generate all payslips: ${t.message}`)}finally{this.isGeneratingAll=!1}},getLatestPosition(t){if(!Array.isArray(t.positionHistory)||t.positionHistory.length===0)return{position:t.position||"N/A",salary:t.salary||0,startDate:t.hireDate||this.currentDate.toISOString().split("T")[0]};const e=[...t.positionHistory].sort((o,n)=>new Date(n.startDate)-new Date(o.startDate));return e.find(o=>!o.endDate)||e[0]},getActivePositionForDate(t,e){var a;if(!Array.isArray(t)||t.length===0)return{position:"N/A",salary:0,startDate:((a=this.selectedEmployee)==null?void 0:a.hireDate)||this.currentDate.toISOString().split("T")[0]};const o=h(e);return t.find(r=>{const d=h(r.startDate),s=r.endDate?h(r.endDate):h(this.currentDate);return o.isSameOrAfter(d,"day")&&o.isSameOrBefore(s,"day")})||t[t.length-1]},async generatePayslipNow(t){this.payslipGenerationStatus.generating=!0;try{const e=h(this.currentDate),o=e.format("YYYY-MM"),n=e.clone().endOf("month").date(),a=e.isBefore(h(`${o}-15`,"YYYY-MM-DD").endOf("day"))?h(`${o}-15`,"YYYY-MM-DD"):h(`${o}-${n}`,"YYYY-MM-DD"),r=this.getActivePositionForDate(t.positionHistory,a);if(!r||!r.position||r.salary===void 0){this.showErrorMessage("No valid position for current date."),console.error("Invalid activePosition:",r);return}const d={...t,position:r.position,salary:r.salary},s=this.getExpectedPayday(t.hireDate,o),u=a.date()===15?"mid-month":"end-of-month",l=`${o}-${u==="mid-month"?"15":n}`;let c={salaryMonth:o,paydayType:u,position:r.position,salary:r.salary,employee:{...d,salaryMonth:l},expectedPaydays:s};const y=this.createPayslipData(c.employee),P=await this.generatePdf(y),D=URL.createObjectURL(P),N=await this.blobToBase64(P),w={employeeId:t.id,empNo:String(t.empNo),payslipData:N.split(",")[1],salaryMonth:c.salaryMonth,paydayType:c.paydayType,position:r.position,salary:Number(r.salary)};if(console.log("Sending payload to backend (generatePayslipNow):",w),!w.employeeId||!w.empNo||!w.payslipData||!w.salaryMonth||!w.paydayType||!w.position||w.salary===void 0||isNaN(w.salary))throw new Error("Payload is missing required fields or contains invalid data");const E=this.authStore.accessToken||localStorage.getItem("token");if(!E)throw new Error("No authentication token available. Please log in.");const T=await Y.post("http://localhost:7777/api/payslips/generate",w,{headers:{Authorization:`Bearer ${E}`,"user-role":"admin"}});if(console.log("Payslip generated successfully (generatePayslipNow):",T.data),T.status===201||T.status===200){c.payslipDataUrl=D,c.totalSalary=this.calculateNetSalary(c.employee);let x=this.allPayslipHistories[t.id]||[];const b=x.findIndex(v=>v.salaryMonth===c.salaryMonth&&v.paydayType===c.paydayType);b!==-1?x[b]=c:x.push(c),this.allPayslipHistories[t.id]=x,this.payslipHistory=x,this.selectedPayslip=c,this.showSuccessMessage(`Payslip generated now for ${t.name} - ${c.paydayType==="mid-month"?s.midMonthPayday:s.endMonthPayday}!`)}}catch(e){console.error("Error generating payslip now:",e),this.showErrorMessage(`Failed to generate payslip: ${e.message}`),e.response&&console.error("Backend response:",e.response.data),e.message==="No authentication token available. Please log in."&&this.$router.push("/admin-login")}finally{this.payslipGenerationStatus.generating=!1}},showUpdatePositionModal(){this.selectedEmployeeForUpdate="",this.newPosition="",this.showUpdateModal=!0},async updateEmployeePosition(){if(!(!this.selectedEmployeeForUpdate||!this.newPosition)){this.isLoading=!0;try{const t=this.employees.find(r=>r.id===this.selectedEmployeeForUpdate),e=this.positions.find(r=>r.name===this.newPosition),o=h(this.currentDate).format("YYYY-MM-DD"),n=t.positionHistory.map(r=>r.endDate?r:{...r,endDate:o});n.push({position:e.name,salary:e.salary,startDate:o,endDate:null}),(await Y.put(`http://localhost:7777/api/employees/${t.id}`,{...t,position:e.name,salary:e.salary,positionHistory:n},{headers:{"user-role":"admin"}})).status===200&&(t.position=e.name,t.salary=e.salary,t.positionHistory=n,this.showSuccessMessage(`Position updated for ${t.name} to ${e.name}!`),this.showUpdateModal=!1,await this.showPayslipHistory(t),await this.generatePayslipNow(t),this.showHistoryModal=!0)}catch(t){console.error("Error updating position:",t),this.showErrorMessage(`Failed to update position: ${t.message}`)}finally{this.isLoading=!1}}},sortPreviousPayslips(t){this.sortPreviousField===t?this.sortPreviousAsc=!this.sortPreviousAsc:(this.sortPreviousField=t,this.sortPreviousAsc=!0)},sortNewPayslips(t){this.sortNewField===t?this.sortNewAsc=!this.sortNewAsc:(this.sortNewField=t,this.sortNewAsc=!0)},showPrintModal(){this.employeesWithPayslips=[],this.selectedEmployeesForPrint=[],this.selectAll=!1;for(const t of this.employees){const o=(this.allPayslipHistories[t.id]||[]).filter(n=>n.payslipDataUrl);if(o.length>0){const n=o.reduce((r,d)=>{const s=h(`${r.salaryMonth}-${r.paydayType==="mid-month"?"15":h(`${r.salaryMonth}-01`).endOf("month").date()}`,"YYYY-MM-DD");return h(`${d.salaryMonth}-${d.paydayType==="mid-month"?"15":h(`${d.salaryMonth}-01`).endOf("month").date()}`,"YYYY-MM-DD").isAfter(s)?d:r}),a=n.paydayType==="mid-month"?n.expectedPaydays.midMonthPayday:n.expectedPaydays.endMonthPayday;this.employeesWithPayslips.push({id:t.id,name:t.name,latestPayslipDate:a,latestPayslip:n})}}this.employeesWithPayslips.length===0?this.showErrorMessage("No employees with generated payslips in history."):this.showPrintAllModal=!0},toggleSelectAll(){this.selectAll?this.selectedEmployeesForPrint=this.employeesWithPayslips.map(t=>t.id):this.selectedEmployeesForPrint=[]},async printSelectedPayslips(){if(this.selectedEmployeesForPrint.length!==0){this.isPrinting=!0;try{const t=new L({orientation:"portrait",unit:"mm",format:[216,279]});for(let e=0;e<this.selectedEmployeesForPrint.length;e++){const o=this.selectedEmployeesForPrint[e],n=this.employeesWithPayslips.find(c=>c.id===o),a=this.employees.find(c=>c.id===o),r=n.latestPayslip,d=h(`${r.salaryMonth}-${r.paydayType==="mid-month"?"15":h(r.salaryMonth).daysInMonth()}`,"YYYY-MM-DD"),s=this.getActivePositionForDate(a.positionHistory,d),u={...a,position:s.position,salary:s.salary},l=this.createPayslipData(u);await this.generatePdf(l,t),e<this.selectedEmployeesForPrint.length-1&&t.addPage()}t.autoPrint(),window.open(t.output("bloburl"),"_blank"),this.showSuccessMessage("Payslips printed successfully!"),this.showPrintAllModal=!1}catch(t){console.error("Error printing payslips:",t),this.showErrorMessage(`Failed to print payslips: ${t.message}`)}finally{this.isPrinting=!1}}},selectPayslip(t){this.selectedPayslip=t.payslipDataUrl?t:null,this.iframeError=!1},async downloadPayslip(){if(!(!this.selectedPayslip||!this.selectedPayslip.payslipDataUrl))try{const t=await fetch(this.selectedPayslip.payslipDataUrl);if(!t.ok)throw new Error("Failed to fetch payslip PDF");const e=await t.blob(),o=window.URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download=`Payslip_${this.selectedEmployee.name}_${this.selectedPayslip.paydayType==="mid-month"?this.selectedPayslip.expectedPaydays.midMonthPayday:this.selectedPayslip.expectedPaydays.endMonthPayday}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o)}catch(t){console.error("Error downloading payslip:",t),this.showErrorMessage("Failed to download payslip.")}},formatDate(t){return h(t).isValid()?h(t).format("D MMMM YYYY"):"Invalid Date"},calculateTotalEarnings(t){const e=(t.earnings?t.earnings.travelExpenses:0)+(t.earnings?t.earnings.otherEarnings:0),o=t.salary||0,n=this.calculateHolidayPay(t)||0,a=this.calculateOvertimePay(t)||0,r=this.calculatePayheadEarnings(t.payheads)||0,d=this.calculateSupplementaryIncome(t)?this.calculateSupplementaryIncome(t).taxable:0;return o+e+n+a+r+d||0},calculatePayheadEarnings(t){return t.filter(e=>e.type==="Earnings").reduce((e,o)=>e+Number(o.amount||0),0)||0},calculatePayheadDeductions(t){return t.filter(e=>e.type==="Deductions").reduce((e,o)=>e+Number(o.amount||0),0)||0},calculateSupplementaryIncome(t){const e=t.commission||0,o=t.profitSharing||0,n=t.fees||0,a=t.thirteenthMonthPay||0,r=t.hazardPay||0,d=this.calculateOvertimePay(t)||0,s=t.otherTaxable||0,u=e+o+n+a+r+d+s,l=Math.min(a,9e4)||0,c=Math.max(0,a-9e4)||0;return{taxable:e+o+n+c+r+d+s||0,nonTaxable:l||0,totalSupplementary:u||0}},calculateNonTaxableIncome(t){const e=t.salary/30<=this.config.minimumWage,o=e?t.salary:0,n=e?this.calculateHolidayPay(t):0,a=e?this.calculateOvertimePay(t):0,r=e&&t.nightShiftDiff||0,d=e&&t.hazardPay||0,s=Math.min(t.thirteenthMonthPay||0,9e4)||0,u=Math.min(t.deMinimis||0,this.config.deMinimisLimit)||0,l=this.calculateSSSContribution(t.salary)||0,c=this.calculatePhilHealthContribution(t.salary)||0,y=this.calculatePagIBIGContribution(t.salary)||0;return{totalNonTaxable:o+n+a+r+d+s+u+l+c+y||0}},calculateTotalDeductions(t){const e=this.calculateSSSContribution(t.salary)||0,o=this.calculatePhilHealthContribution(t.salary)||0,n=this.calculatePagIBIGContribution(t.salary)||0,a=this.calculateWithholdingTax(t)||0,r=this.calculatePayheadDeductions(t.payheads)||0;return e+o+n+a+r||0},calculateNetSalary(t){const e=this.calculateTotalEarnings(t)||0,o=this.calculateTotalDeductions(t)||0;return e-o||0},calculateHolidayPay(t){const e=t.salary/30||0,o=t.salaryMonth?t.salaryMonth.split("-")[0]+"-"+t.salaryMonth.split("-")[1]:h(this.currentDate).format("YYYY-MM"),n=this.config.regularHolidays||[],a=this.config.specialNonWorkingDays||[],r=n.some(s=>h(s,"MM/DD/YYYY").format("YYYY-MM")===o),d=a.some(s=>h(s,"MM/DD/YYYY").format("YYYY-MM")===o);return r?e*2||0:d&&e*1.3||0},calculateOvertimePay(t){const e=t.salary/176||0,o=t.overtimeHours?t.overtimeHours.regular:0,n=t.overtimeHours?t.overtimeHours.holiday:0,a=o*e*1.25||0,r=n*e*1.3||0;return a+r||0},calculateSSSContribution(t){const e=Math.min(Math.max(t||0,5e3),35e3)||0;return Math.round(e*.045)||0},calculatePhilHealthContribution(t){const o=Math.min(t||0,1e5)||0;return Math.round(o*.05/2)||0},calculatePagIBIGContribution(t){const o=Math.min(t||0,1e4)||0;return Math.round(o*.02)||0},calculateWithholdingTax(t){const e=this.calculateNonTaxableIncome(t).totalNonTaxable||0,o=(this.calculateTotalEarnings(t)||0)-e||0;return o<=20833?0:o<=33333?Math.round((o-20833)*.15)||0:o<=66667?Math.round(1875+(o-33333)*.2)||0:o<=166667?Math.round(13541.8+(o-66667)*.25)||0:o<=666667?Math.round(90841.8+(o-166667)*.3)||0:Math.round(408841.8+(o-666667)*.35)||0},getExpectedPayday(t,e){const[o,n]=e.split("-").map(l=>parseInt(l,10)),a=new Date(o,n,0).getDate();let r=new Date(o,n-1,15),d=new Date(o,n-1,a);const s=h(t);s.isAfter(h(`${o}-${n}-15`,"YYYY-MM-DD"))&&(r=s.toDate()),s.isAfter(h(`${o}-${n}-${a}`,"YYYY-MM-DD"))&&(d=s.toDate());const u=l=>l.getDay()===0||l.getDay()===6;for(;u(r);){const l=new Date(r);if(l.setDate(r.getDate()+1),l.getMonth()!==r.getMonth())break;r=l}for(;u(d);){const l=new Date(d);if(l.setDate(d.getDate()-1),l.getMonth()!==d.getMonth())break;d=l}return{midMonthPayday:r.toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"}),endMonthPayday:d.toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"})}},createPayslipData(t){const e=h(t.salaryMonth,"YYYY-MM-DD").format("MM/DD/YYYY"),o=t.salary||0,n=this.calculateSSSContribution(o)||0,a=this.calculatePhilHealthContribution(o)||0,r=this.calculatePagIBIGContribution(o)||0,d=n+a+r+(this.calculateWithholdingTax(t)||0)||0,s=this.calculateNetSalary(t)||0,u=t.paidLeaves?t.paidLeaves.days:0,l=t.absences?t.absences.days:0,c=t.paidLeaves?t.paidLeaves.amount:0,y=t.absences?-t.absences.amount:0,P=this.getExpectedPayday(t.hireDate,t.salaryMonth.split("-")[0]+"-"+t.salaryMonth.split("-")[1]);return{salaryDate:e,empNo:t.empNo||"N/A",lastName:t.lastName||"N/A",middleName:t.middleName||"N/A",firstName:t.firstName||"N/A",birthDate:h(t.birthDate).isValid()?h(t.birthDate).format("MM/DD/YYYY"):"N/A",hireDate:h(t.hireDate).isValid()?h(t.hireDate).format("MM/DD/YYYY"):"N/A",civilStatus:t.civilStatus||"SINGLE",dependents:t.dependents||0,sss:t.sss||"N/A",tin:t.tin||"N/A",philhealth:t.philhealth||"N/A",pagibig:t.pagibig||"N/A",position:this.getPositionName(t.position)||"N/A",basicSalary:this.formatNumber(o),totalDeductions:this.formatNumber(d),netSalary:this.formatNumber(s),sssDeduction:this.formatNumber(n),philhealthDeduction:this.formatNumber(a),pagibigDeduction:this.formatNumber(r),paidLeavesDays:u,absencesDays:l,paidLeavesAmount:this.formatNumber(c),absencesAmount:this.formatNumber(y),withholdingTax:this.formatNumber(this.calculateWithholdingTax(t)||0),payheads:t.payheads||[],expectedPaydays:P}},formatNumber(t){return(Number(t)||0).toFixed(2)},async generatePdf(t,e){const o=e||new L({orientation:"portrait",unit:"mm",format:[216,279]});o.setFont("Helvetica");const n=10,r=o.internal.pageSize.getWidth()-2*n,d=(r-20)/2,s=5,u=o.internal.pageSize.getHeight();function l(x,b,v,C,M){M=M||{},b=b||"N/A",b=b.replace("₱","P"),x.setFontSize(M.fontSize||10),x.setFont(M.font||"Helvetica",M.fontStyle||"normal"),x.setTextColor(M.textColor?M.textColor[0]:0,M.textColor?M.textColor[1]:0,M.textColor?M.textColor[2]:0),x.text(b,v,C,{align:M.align||"left",maxWidth:M.maxWidth})}function c(x,b,v,C,M){l(x,b,C,M,{fontSize:9,fontStyle:"bold"}),l(x,v,C+35,M,{fontSize:9,maxWidth:d-35})}o.setFillColor(0,128,0),o.rect(n,n,r,10,"F"),l(o,"RIGHTJOB Solutions",n+5,n+7,{fontSize:12,fontStyle:"bold",textColor:[255,255,255]}),l(o,"PAYSLIP",n+r/2,n+7,{fontSize:12,fontStyle:"bold",textColor:[255,255,255],align:"center"});let y=n+15;l(o,"Salary Date:",n+r-40,y,{fontSize:9}),l(o,t.salaryDate,n+r-20,y,{fontSize:9}),y+=10,l(o,"Personal Information",n,y,{fontSize:11,fontStyle:"bold"}),y+=s;const P=[["Emp No.",t.empNo],["Last Name",t.lastName],["Middle Name",t.middleName],["First Name",t.firstName],["Birth Date",t.birthDate],["Hire Date",t.hireDate],["Position",t.position],["Basic Salary",`P${t.basicSalary}`]];P.forEach(([x,b],v)=>{c(o,x,b,n,y+v*s)});let D=y;l(o,"Additional Info",n+d+10,D,{fontSize:11,fontStyle:"bold"}),D+=s;const N=[["Civil Status",t.civilStatus],["Dependents",t.dependents.toString()],["SSS",t.sss],["TIN",t.tin],["Philhealth",t.philhealth],["PAG-IBIG",t.pagibig]];N.forEach(([x,b],v)=>{c(o,x,b,n+d+10,D+v*s)}),y=Math.max(y+P.length*s,D+N.length*s)+10,l(o,"Expected Paydays",n,y,{fontSize:11,fontStyle:"bold"}),l(o,"Mid-Month:",n,y+s),l(o,t.expectedPaydays.midMonthPayday,n+35,y+s,{maxWidth:d-35}),l(o,"End-of-Month:",n+d+10,y+s),l(o,t.expectedPaydays.endMonthPayday,n+d+45,y+s,{maxWidth:d-35}),y+=2*s+10,l(o,"Deductions",n,y,{fontSize:11,fontStyle:"bold"}),y+=s;const w=[["SSS",`P${t.sssDeduction}`],["Philhealth",`P${t.philhealthDeduction}`],["PAG-IBIG",`P${t.pagibigDeduction}`]];w.forEach(([x,b],v)=>{c(o,x,b,n,y+v*s)});const E=[["Withholding Tax",`P${t.withholdingTax}`]];E.forEach(([x,b],v)=>{c(o,x,b,n+d+10,y+v*s)}),y+=Math.max(w.length,E.length)*s+10,l(o,"Summary",n,y,{fontSize:11,fontStyle:"bold"}),y+=s,l(o,"Total Deductions:",n,y,{fontSize:9,fontStyle:"bold"}),l(o,`(P${t.totalDeductions})`,n+35,y,{fontSize:9}),l(o,"Net Salary:",n+d+10,y,{fontSize:9,fontStyle:"bold"}),l(o,`P${t.netSalary}`,n+d+45,y,{fontSize:9});const T=u-n-5;if(l(o,"This is a computer-generated payslip; no signature required.",n+r/2,T,{fontSize:8,align:"center"}),!e)return o.output("blob")},blobToBase64(t){return new Promise((e,o)=>{const n=new FileReader;n.onloadend=()=>e(n.result),n.onerror=o,n.readAsDataURL(t)})},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},onIframeLoad(){this.iframeError=!1},onIframeError(){this.iframeError=!0,this.showErrorMessage("Error loading payslip preview.")},showSuccessMessage(t){this.statusMessage=t,setTimeout(()=>{this.statusMessage=""},3e3)},showErrorMessage(t){this.statusMessage=t,setTimeout(()=>{this.statusMessage=""},5e3)}}},R={class:"min-h-screen p-1"},j={class:"max-w-8xl mx-auto"},V={class:"bg-white rounded-lg shadow-sm p-4 mb-4"},q={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},Q={class:"relative"},J=["disabled"],K={class:"material-icons text-sm"},X=["disabled"],Z={class:"material-icons text-sm"},$=["disabled"],tt=["disabled"],et={class:"bg-white rounded-lg shadow-sm overflow-hidden"},st={class:"overflow-x-auto"},at={class:"min-w-full divide-y divide-gray-200 mb-4"},it={class:"bg-white divide-y divide-gray-200"},ot=["onClick"],rt={class:"px-4 py-3 text-sm text-gray-900"},nt={class:"px-4 py-3 text-sm text-gray-500"},lt={class:"px-4 py-3 text-sm text-gray-500"},dt={class:"px-4 py-3 text-sm text-gray-900"},yt={class:"px-4 py-3 text-sm text-blue-600"},ct={key:0},ht={key:1},pt={class:"flex items-center justify-between px-4 py-3 bg-gray-50"},ut={class:"text-xs text-gray-700"},gt={class:"flex gap-2"},mt=["disabled"],ft=["disabled"],xt={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"},Pt={class:"bg-white rounded-lg shadow-xl w-full max-w-5xl h-[80vh] flex flex-col"},bt={class:"flex items-center justify-between p-4 border-b"},wt={class:"text-base font-medium text-gray-800 flex items-center gap-1"},Mt={class:"flex items-center gap-2"},Dt=["disabled"],vt={class:"flex flex-1 overflow-hidden"},St={class:"w-1/2 p-4 overflow-y-auto border-r"},Et={class:"min-w-full divide-y divide-gray-200"},Nt={class:"bg-gray-50 sticky top-0"},Yt={class:"material-icons text-xs"},kt={class:"material-icons text-xs"},At={class:"divide-y divide-gray-200"},Tt=["onClick"],Ht={class:"px-4 py-2 text-sm text-gray-900"},Ct={class:"px-4 py-2 text-sm text-gray-500"},_t={class:"px-4 py-2 text-sm text-gray-500"},It={class:"px-4 py-2 text-sm text-gray-500"},Lt={class:"px-4 py-2"},Ft=["onClick","disabled"],Ut={key:0},Wt={key:0},Gt={class:"min-w-full divide-y divide-gray-200"},zt={class:"bg-gray-50 sticky top-0"},Bt={class:"material-icons text-xs"},Ot={class:"material-icons text-xs"},Rt={class:"divide-y divide-gray-200"},jt=["onClick"],Vt={class:"px-4 py-2 text-sm text-gray-900"},qt={class:"px-4 py-2 text-sm text-gray-500"},Qt={class:"px-4 py-2 text-sm text-gray-500"},Jt={class:"px-4 py-2 text-sm text-gray-500"},Kt={class:"px-4 py-2"},Xt=["onClick","disabled"],Zt={key:0},$t={class:"w-1/2 p-4 overflow-y-auto"},te={key:0,class:"flex flex-col h-full"},ee={class:"mb-4"},se={class:"text-sm text-gray-600"},ae=["src"],ie={key:0,class:"mt-3 p-3 bg-red-50 text-red-700 rounded text-sm flex items-center gap-1"},oe={key:1,class:"text-sm text-gray-500 text-center mt-4"},re={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"},ne={class:"bg-white rounded-lg shadow-xl w-full max-w-md p-6"},le={class:"mb-4"},de=["value"],ye={class:"mb-4"},ce=["value"],he={class:"flex justify-end gap-2"},pe=["disabled"],ue={key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"},ge={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col"},me={class:"flex items-center justify-between p-4 border-b"},fe={class:"p-4 overflow-y-auto"},xe={key:0,class:"mb-4"},Pe={class:"flex items-center"},be={key:1},we=["value"],Me={class:"text-sm text-gray-900"},De={key:2,class:"text-sm text-gray-500 text-center py-4"},ve={class:"p-4 border-t flex justify-end gap-2"},Se=["disabled"],Ee={class:"material-icons text-sm"};function Ne(t,e,o,n,a,r){var d;return m(),g("div",R,[i("div",j,[i("div",V,[i("div",q,[i("div",Q,[e[26]||(e[26]=i("span",{class:"material-icons absolute left-2 top-2 text-gray-400 text-sm"},"search",-1)),H(i("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.searchQuery=s),type:"text",placeholder:"Search employee by name...",class:"w-full pl-8 pr-3 py-2 text-sm rounded-md border border-gray-200 focus:ring-2 focus:ring-blue-400 focus:border-transparent"},null,512),[[z,a.searchQuery]])]),i("button",{onClick:e[1]||(e[1]=(...s)=>r.refreshData&&r.refreshData(...s)),class:"flex items-center justify-center gap-1 bg-blue-500 hover:bg-blue-600 text-white text-sm py-2 px-4 rounded-md",disabled:a.isLoading},[i("span",K,p(a.isLoading?"sync":"refresh"),1),f(" "+p(a.isLoading?"Refreshing...":"Refresh Data"),1)],8,J),i("button",{onClick:e[2]||(e[2]=(...s)=>r.generateAllPayslips&&r.generateAllPayslips(...s)),class:"flex items-center justify-center gap-1 bg-green-500 hover:bg-green-600 text-white text-sm py-2 px-4 rounded-md",disabled:a.isLoading||a.isGeneratingAll},[i("span",Z,p(a.isGeneratingAll?"sync":"description"),1),f(" "+p(a.isGeneratingAll?"Generating...":"Generate All"),1)],8,X),i("button",{onClick:e[3]||(e[3]=(...s)=>r.showPrintModal&&r.showPrintModal(...s)),class:"flex items-center justify-center gap-1 bg-purple-500 hover:bg-purple-600 text-white text-sm py-2 px-4 rounded-md",disabled:a.isLoading},e[27]||(e[27]=[i("span",{class:"material-icons text-sm"},"print",-1),f(" Print All ")]),8,$),i("button",{onClick:e[4]||(e[4]=(...s)=>r.showUpdatePositionModal&&r.showUpdatePositionModal(...s)),class:"flex items-center justify-center gap-1 bg-orange-500 hover:bg-orange-600 text-white text-sm py-2 px-4 rounded-md",disabled:a.isLoading},e[28]||(e[28]=[i("span",{class:"material-icons text-sm"},"edit",-1),f(" Update Position ")]),8,tt)])]),i("div",et,[i("div",st,[i("table",at,[e[31]||(e[31]=i("thead",{class:"bg-gray-50"},[i("tr",null,[i("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},[i("div",{class:"flex items-center gap-1"},[i("span",{class:"material-icons text-gray-400 text-sm"},"person"),f(" Name ")])]),i("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},[i("div",{class:"flex items-center gap-1"},[i("span",{class:"material-icons text-gray-400 text-sm"},"badge"),f(" Employee ID ")])]),i("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},[i("div",{class:"flex items-center gap-1"},[i("span",{class:"material-icons text-gray-400 text-sm"},"work"),f(" Position ")])]),i("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},[i("div",{class:"flex items-center gap-1"},[i("span",{class:"material-icons text-gray-400 text-sm"},"payments"),f(" Hourly Rate ")])]),i("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"},[i("div",{class:"flex items-center gap-1"},[i("span",{class:"material-icons text-gray-400 text-sm"},"account_balance_wallet"),f(" Basic Salary ")])])])],-1)),i("tbody",it,[(m(!0),g(k,null,A(r.paginatedEmployees,s=>(m(),g("tr",{key:s.id,class:"hover:bg-blue-50 transition-colors cursor-pointer",onClick:u=>r.showPayslipHistory(s)},[i("td",rt,p(s.name),1),i("td",nt,p(s.empNo),1),i("td",lt,p(r.getPositionName(s.position)),1),i("td",dt," ₱"+p(r.getHourlyRate(s.position).toLocaleString()),1),i("td",yt," ₱"+p(r.getPositionSalary(s.position).toLocaleString()),1)],8,ot))),128)),r.paginatedEmployees.length===0&&!a.isLoading?(m(),g("tr",ct,e[29]||(e[29]=[i("td",{colspan:"5",class:"px-4 py-8 text-center"},[i("div",{class:"flex flex-col items-center gap-2"},[i("span",{class:"material-icons text-gray-400 text-3xl"},"search_off"),i("p",{class:"text-sm text-gray-500"},"No employees found.")])],-1)]))):S("",!0),a.isLoading?(m(),g("tr",ht,e[30]||(e[30]=[i("td",{colspan:"5",class:"px-4 py-8 text-center"},[i("div",{class:"flex flex-col items-center gap-2"},[i("span",{class:"material-icons text-blue-500 animate-spin text-3xl"},"sync"),i("p",{class:"text-sm text-gray-500"},"Loading employees...")])],-1)]))):S("",!0)])])]),i("div",pt,[i("div",ut," Showing page "+p(a.currentPage)+" of "+p(r.totalPages),1),i("div",gt,[i("button",{onClick:e[5]||(e[5]=(...s)=>r.prevPage&&r.prevPage(...s)),disabled:a.currentPage===1||a.isLoading,class:"inline-flex items-center px-3 py-1 text-xs bg-white border border-gray-300 rounded text-gray-700 hover:bg-gray-50"},e[32]||(e[32]=[i("span",{class:"material-icons text-sm mr-1"},"chevron_left",-1),f(" Previous ")]),8,mt),i("button",{onClick:e[6]||(e[6]=(...s)=>r.nextPage&&r.nextPage(...s)),disabled:a.currentPage===r.totalPages||a.isLoading,class:"inline-flex items-center px-3 py-1 text-xs bg-white border border-gray-300 rounded text-gray-700 hover:bg-gray-50"},e[33]||(e[33]=[f(" Next "),i("span",{class:"material-icons text-sm ml-1"},"chevron_right",-1)]),8,ft)])])]),a.showHistoryModal?(m(),g("div",xt,[i("div",Pt,[i("div",bt,[i("h2",wt,[e[34]||(e[34]=i("span",{class:"material-icons text-sm"},"history",-1)),f(" Payslip History - "+p((d=a.selectedEmployee)==null?void 0:d.name),1)]),i("div",Mt,[i("button",{onClick:e[7]||(e[7]=_(s=>r.generatePayslipNow(a.selectedEmployee),["stop"])),class:"flex items-center justify-center gap-1 bg-yellow-500 hover:bg-yellow-600 text-white text-sm py-2 px-4 rounded-md",disabled:a.isLoading||a.payslipGenerationStatus.generating},[e[35]||(e[35]=i("span",{class:"material-icons text-sm"},"play_arrow",-1)),f(" "+p(a.payslipGenerationStatus.generating?"Generating...":"Generate Now"),1)],8,Dt),i("button",{onClick:e[8]||(e[8]=s=>a.showHistoryModal=!1),class:"p-1 hover:bg-gray-100 rounded-full"},e[36]||(e[36]=[i("span",{class:"material-icons text-sm"},"close",-1)]))])]),i("div",vt,[i("div",St,[e[52]||(e[52]=i("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Previous Position Payslips",-1)),i("table",Et,[i("thead",Nt,[i("tr",null,[i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 cursor-pointer",onClick:e[9]||(e[9]=s=>r.sortPreviousPayslips("payDate"))},[e[37]||(e[37]=f(" Pay Date ")),i("span",Yt,p(a.sortPreviousField==="payDate"?a.sortPreviousAsc?"arrow_upward":"arrow_downward":""),1)]),i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 cursor-pointer",onClick:e[10]||(e[10]=s=>r.sortPreviousPayslips("position"))},[e[38]||(e[38]=f(" Position ")),i("span",kt,p(a.sortPreviousField==="position"?a.sortPreviousAsc?"arrow_upward":"arrow_downward":""),1)]),e[39]||(e[39]=i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500"},"Salary",-1)),e[40]||(e[40]=i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500"},"Status",-1)),e[41]||(e[41]=i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500"},"Action",-1))])]),i("tbody",At,[(m(!0),g(k,null,A(r.sortedPreviousPayslips,s=>{var u,l,c,y;return m(),g("tr",{key:`${s.salaryMonth}-${s.paydayType}`,class:I(["hover:bg-blue-50 cursor-pointer",{"bg-blue-100":((u=a.selectedPayslip)==null?void 0:u.salaryMonth)===s.salaryMonth&&((l=a.selectedPayslip)==null?void 0:l.paydayType)===s.paydayType}]),onClick:P=>r.selectPayslip(s)},[i("td",Ht,p(s.paydayType==="mid-month"?s.expectedPaydays.midMonthPayday:s.expectedPaydays.endMonthPayday),1),i("td",Ct,p(r.getPositionName(s.position)),1),i("td",_t," ₱"+p(s.salary.toLocaleString()),1),i("td",It,p(s.payslipDataUrl?"Generated":"Pending"),1),i("td",Lt,[s.payslipDataUrl?S("",!0):(m(),g("button",{key:0,onClick:_(P=>r.generatePayslip(s),["stop"]),class:"inline-flex items-center gap-1 px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600",disabled:!r.canGeneratePayslip(s)||((c=a.payslipGenerationStatus[`${s.salaryMonth}-${s.paydayType}`])==null?void 0:c.generating)},[e[42]||(e[42]=i("span",{class:"material-icons text-sm"},"description",-1)),f(" "+p((y=a.payslipGenerationStatus[`${s.salaryMonth}-${s.paydayType}`])!=null&&y.generating?"Generating...":"Generate"),1)],8,Ft))])],10,Tt)}),128)),r.sortedPreviousPayslips.length===0?(m(),g("tr",Ut,e[43]||(e[43]=[i("td",{colspan:"5",class:"px-4 py-4 text-center text-sm text-gray-500"},"No previous payslips available. ",-1)]))):S("",!0)])]),r.hasUpdatedPosition?(m(),g("div",Wt,[e[51]||(e[51]=i("h3",{class:"text-sm font-medium text-gray-700 mt-6 mb-2"},"New Position Payslips",-1)),i("table",Gt,[i("thead",zt,[i("tr",null,[i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 cursor-pointer",onClick:e[11]||(e[11]=s=>r.sortNewPayslips("payDate"))},[e[44]||(e[44]=f(" Pay Date ")),i("span",Bt,p(a.sortNewField==="payDate"?a.sortNewAsc?"arrow_upward":"arrow_downward":""),1)]),i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 cursor-pointer",onClick:e[12]||(e[12]=s=>r.sortNewPayslips("position"))},[e[45]||(e[45]=f(" Position ")),i("span",Ot,p(a.sortNewField==="position"?a.sortNewAsc?"arrow_upward":"arrow_downward":""),1)]),e[46]||(e[46]=i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500"},"Salary ",-1)),e[47]||(e[47]=i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500"},"Status ",-1)),e[48]||(e[48]=i("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500"},"Action ",-1))])]),i("tbody",Rt,[(m(!0),g(k,null,A(r.sortedNewPayslips,s=>{var u,l,c,y;return m(),g("tr",{key:`${s.salaryMonth}-${s.paydayType}`,class:I(["hover:bg-blue-50 cursor-pointer",{"bg-blue-100":((u=a.selectedPayslip)==null?void 0:u.salaryMonth)===s.salaryMonth&&((l=a.selectedPayslip)==null?void 0:l.paydayType)===s.paydayType}]),onClick:P=>r.selectPayslip(s)},[i("td",Vt,p(s.paydayType==="mid-month"?s.expectedPaydays.midMonthPayday:s.expectedPaydays.endMonthPayday),1),i("td",qt,p(r.getPositionName(s.position)),1),i("td",Qt," ₱"+p(s.salary.toLocaleString()),1),i("td",Jt,p(s.payslipDataUrl?"Generated":"Pending"),1),i("td",Kt,[s.payslipDataUrl?S("",!0):(m(),g("button",{key:0,onClick:_(P=>r.generatePayslip(s),["stop"]),class:"inline-flex items-center gap-1 px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600",disabled:!r.canGeneratePayslip(s)||((c=a.payslipGenerationStatus[`${s.salaryMonth}-${s.paydayType}`])==null?void 0:c.generating)},[e[49]||(e[49]=i("span",{class:"material-icons text-sm"},"description",-1)),f(" "+p((y=a.payslipGenerationStatus[`${s.salaryMonth}-${s.paydayType}`])!=null&&y.generating?"Generating...":"Generate"),1)],8,Xt))])],10,jt)}),128)),r.sortedNewPayslips.length===0?(m(),g("tr",Zt,e[50]||(e[50]=[i("td",{colspan:"5",class:"px-4 py-4 text-center text-sm text-gray-500"},"No new payslips available. ",-1)]))):S("",!0)])])])):S("",!0)]),i("div",$t,[e[55]||(e[55]=i("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Payslip Preview",-1)),a.selectedPayslip&&a.selectedPayslip.payslipDataUrl?(m(),g("div",te,[i("div",ee,[i("p",se," Position: "+p(r.getPositionName(a.selectedPayslip.position))+" | Salary: ₱"+p(a.selectedPayslip.salary.toLocaleString()),1)]),i("iframe",{src:a.selectedPayslip.payslipDataUrl,class:"w-full h-[50vh] rounded border mb-4",onLoad:e[13]||(e[13]=(...s)=>r.onIframeLoad&&r.onIframeLoad(...s)),onError:e[14]||(e[14]=(...s)=>r.onIframeError&&r.onIframeError(...s))},null,40,ae),i("button",{onClick:e[15]||(e[15]=(...s)=>r.downloadPayslip&&r.downloadPayslip(...s)),class:"flex items-center justify-center gap-1 bg-blue-500 hover:bg-blue-600 text-white text-sm py-2 px-4 rounded-md"},e[53]||(e[53]=[i("span",{class:"material-icons text-sm"},"download",-1),f(" Download PDF ")])),a.iframeError?(m(),g("div",ie,e[54]||(e[54]=[i("span",{class:"material-icons text-sm"},"error",-1),f(" Error loading payslip. Please try again. ")]))):S("",!0)])):(m(),g("div",oe," Select a payslip from the list to preview. "))])])])])):S("",!0),a.showUpdateModal?(m(),g("div",re,[i("div",ne,[e[61]||(e[61]=i("h2",{class:"text-base font-medium text-gray-800 mb-4 flex items-center gap-1"},[i("span",{class:"material-icons text-sm"},"edit"),f(" Update Employee Position ")],-1)),i("div",le,[e[57]||(e[57]=i("label",{class:"block text-sm text-gray-700 mb-1"},"Select Employee",-1)),H(i("select",{"onUpdate:modelValue":e[16]||(e[16]=s=>a.selectedEmployeeForUpdate=s),class:"w-full p-2 border rounded text-sm"},[e[56]||(e[56]=i("option",{value:"",disabled:""},"Select an employee",-1)),(m(!0),g(k,null,A(a.employees,s=>(m(),g("option",{key:s.id,value:s.id},p(s.name)+" ("+p(r.getPositionName(s.position))+") ",9,de))),128))],512),[[F,a.selectedEmployeeForUpdate]])]),i("div",ye,[e[59]||(e[59]=i("label",{class:"block text-sm text-gray-700 mb-1"},"New Position",-1)),H(i("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>a.newPosition=s),class:"w-full p-2 border rounded text-sm"},[e[58]||(e[58]=i("option",{value:"",disabled:""},"Select a position",-1)),(m(!0),g(k,null,A(a.positions,s=>(m(),g("option",{key:s.name,value:s.name},p(s.name)+" (₱"+p(s.salary.toLocaleString())+") ",9,ce))),128))],512),[[F,a.newPosition]])]),i("div",he,[i("button",{onClick:e[18]||(e[18]=s=>a.showUpdateModal=!1),class:"px-4 py-2 text-sm text-gray-700 bg-gray-200 rounded hover:bg-gray-300"}," Cancel "),i("button",{onClick:e[19]||(e[19]=(...s)=>r.updateEmployeePosition&&r.updateEmployeePosition(...s)),class:"flex items-center gap-1 px-4 py-2 text-sm text-white bg-orange-500 rounded hover:bg-orange-600",disabled:!a.selectedEmployeeForUpdate||!a.newPosition||a.isLoading},e[60]||(e[60]=[i("span",{class:"material-icons text-sm"},"save",-1),f(" Update ")]),8,pe)])])])):S("",!0),a.showPrintAllModal?(m(),g("div",ue,[i("div",ge,[i("div",me,[e[63]||(e[63]=i("h2",{class:"text-base font-medium text-gray-800 flex items-center gap-1"},[i("span",{class:"material-icons text-sm"},"print"),f(" Print Payslips ")],-1)),i("button",{onClick:e[20]||(e[20]=s=>a.showPrintAllModal=!1),class:"p-1 hover:bg-gray-100 rounded-full"},e[62]||(e[62]=[i("span",{class:"material-icons text-sm"},"close",-1)]))]),i("div",fe,[e[65]||(e[65]=i("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Select Employees to Print",-1)),a.employeesWithPayslips.length>0?(m(),g("div",xe,[i("label",Pe,[H(i("input",{type:"checkbox","onUpdate:modelValue":e[21]||(e[21]=s=>a.selectAll=s),onChange:e[22]||(e[22]=(...s)=>r.toggleSelectAll&&r.toggleSelectAll(...s)),class:"large-checkbox mr-2"},null,544),[[U,a.selectAll]]),e[64]||(e[64]=i("span",{class:"text-sm text-gray-900 font-medium"},"Select All",-1))])])):S("",!0),a.employeesWithPayslips.length>0?(m(),g("div",be,[(m(!0),g(k,null,A(a.employeesWithPayslips,s=>(m(),g("div",{key:s.id,class:"flex items-center py-2 border-b"},[H(i("input",{type:"checkbox","onUpdate:modelValue":e[23]||(e[23]=u=>a.selectedEmployeesForPrint=u),value:s.id,class:"large-checkbox mr-2"},null,8,we),[[U,a.selectedEmployeesForPrint]]),i("span",Me,p(s.name)+" - Most Recent: "+p(s.latestPayslipDate),1)]))),128))])):(m(),g("div",De," No employees with generated payslips found in history. "))]),i("div",ve,[i("button",{onClick:e[24]||(e[24]=s=>a.showPrintAllModal=!1),class:"px-4 py-2 text-sm text-gray-700 bg-gray-200 rounded hover:bg-gray-300"}," Cancel "),i("button",{onClick:e[25]||(e[25]=(...s)=>r.printSelectedPayslips&&r.printSelectedPayslips(...s)),class:"flex items-center gap-1 px-4 py-2 text-sm text-white bg-purple-500 rounded hover:bg-purple-600",disabled:a.selectedEmployeesForPrint.length===0||a.isPrinting},[e[66]||(e[66]=i("span",{class:"material-icons text-sm"},"print",-1)),f(" "+p(a.isPrinting?"Printing...":"Print Selected"),1)],8,Se)])])])):S("",!0),a.statusMessage?(m(),g("div",{key:3,class:I([a.statusMessage.includes("successfully")?"bg-green-50 text-green-700":"bg-red-50 text-red-700","fixed bottom-4 right-4 p-3 rounded shadow-lg z-50 flex items-center gap-1 animate-fade-in text-sm"])},[i("span",Ee,p(a.statusMessage.includes("successfully")?"check_circle":"error"),1),f(" "+p(a.statusMessage),1)],2)):S("",!0)])])}const He=G(O,[["render",Ne],["__scopeId","data-v-036c79a5"]]);export{He as default};
